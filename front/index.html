<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<title>VagaCursos</title>

	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
	<div id="div_inicial" class="container">
		<div class="row">
			<div class="col-md-3">
				<h1>VagaCursos</h1>

				<img src="imagens/logo.jpg" width="100%">
			</div>

			<div class="col-md-6">
				<br><br>
				<div class="row">
					<input class="col-md-6" type="text" placeholder="Email" id="email_login" name="email">
					<div class="w-100"></div>
					<input class="col-md-6" type="password" placeholder="Senha" id="senha_login" name="senha">
					<div class="w-100"></div>
					<input class="col-md-6" type="button" value="Login" id="login">
				</div>

				<br>

				<div class="row">
					<input class="col-md-6" type="button" value="Cadastre-se" id="cadastre_se">
				</div>

			</div>
		</div>
	</div>

	<div id="div_cadastro" class="container">
		<div class="row">
			<div class="col-md-3">
				<h1>Cadastro</h1>

				<img src="imagens/logo.jpg" width="100%">
			</div>

			<div class="col-md-6">
				<br><br>

				<div class="row">
					<input class="col-md-6" type="text" placeholder="Nome" id="nome" name="nome">
					<div class="w-100"></div>
					<input class="col-md-6" type="text" placeholder="Sobrenome" id="sobrenome" name="sobrenome">
					<div class="w-100"></div>
					<input class="col-md-6" type="text" placeholder="Email" id="email_cadastro" name="email">
					<div class="w-100"></div>
					<input class="col-md-6" type="password" placeholder="Senha" id="senha_cadastro" name="senha">
					<div class="w-100"></div>
					<input class="col-md-6" type="button" value="Cadastrar" id="cadastrar">					
				</div>

				<br>

				<div class="row">
					<input class="col-md-6" type="button" value="Voltar" id="voltar_inicial">
				</div>
			</div>
		</div>
	</div>

	<div id="div_principal">
		<div class="row">
				<div class="col-md-1">
					<img src="imagens/logo.jpg" height="50" width="100">
				</div>
				<div class="col-md-2">
					<span id="titulo_pagina"></span>
				</div>
				<div class="col-md-1"></div>
				<div class="col-md-1"></div>
				<div class="col-md-1"></div>
				<div class="col-md-1"></div>
				<div class="col-md-1"></div>
				<div class="col-md-1"></div>
				<div class="col-md-1"></div>
				<div class="col-md-1"></div>
				<div class="col-md-1 row">
					<span class="col-md-6" id="bem_vindo_mensagem">Olá, Lucas</span>
					<img id="imagem_perfil" class="col-md-6" src="imagens/default-avatar.jpg">
				</div>
		</div>

		<br>

		<div id="opcoes_div" class="row">
			<div class="col-md-1">
				<input type="button" name="categorias" value="Categorias" id="botao_categorias">

				<div id="categorias_modal" class="modal">
					<div class="conteudo_modal">
						<span id="close_categorias_modal">&times;</span>
						<h1>Categorias</h1>
						<ul id="lista_categorias">
						</ul>
					</div>
				</div>

			</div>
			<div class="col-md-1"></div>
			<div class="col-md-1"></div>
			<div class="col-md-4">
				<input type="text" id="buscar_curso" placeholder="Curso">
				<input type="button" id="buscar_curso" value="Buscar">
			</div>
			<div class="col-md-2">
				<input type="button" id="adicionar_curso" value="Adicionar curso">
			</div>
			<div class="col-md-1"></div>
			<div class="col-md-1"></div>
			<div class="col-md-1"></div>
		</div>

		<div class="container" id="div_cursos">
			<h1>Cursos</h1>
		</div>
	</div>

	<div id="editar_perfil_div" class="row">
		<div class="container">
			<span class="bold">Nome</span><br>
			<input class="col-md-2" type="text" id="editar_perfil_nome">
			<div class="w-100"><br></div>
			<span class="bold">Sobrenome</span><br>
			<input class="col-md-2" type="text" id="editar_perfil_sobrenome">
			<div class="w-100"><br></div>
			<span class="bold">Email</span><br>
			<input class="col-md-2" type="text" id="editar_perfil_email" readonly>
			<div class="w-100"><br></div>
			<span class="bold">Senha</span><br>
			<input class="col-md-2" type="password" id="editar_perfil_senha">
			<div class="w-100"><br></div>
			<span class="bold">Descrição</span><br>
			<textarea class="col-md-4" id="editar_perfil_descricao" heigth="100"></textarea>
			<div class="w-100"><br></div>
			<input class="col-md-2" type="button" id="salvar_perfil_botao" value="Salvar">
			<span id="editar_perfil_status"></span><br>
			<div class="w-100"><br></div>
			<input class="col-md-2" type="button" id="salvar_perfil_voltar" value="Voltar">
		</div>
	</div>
</body>
</html>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="js/cookies.js"></script>

<script type="text/javascript">
	String.prototype.hashCode = function() {
	  	var hash = 0, i, chr;
	  	if (this.length === 0) return hash;
	  	
	  	for (i = 0; i < this.length; i++) {
	    	chr   = this.charCodeAt(i);
	    	hash  = ((hash << 5) - hash) + chr;
	    	hash |= 0; // Convert to 32bit integer
	  	}
	  	return hash;
	};

	var usuario;

	document.getElementById("div_cadastro").style.display = "none";
	document.getElementById("editar_perfil_div").style.display = "none";
	document.getElementById("email_login").value = "";
	document.getElementById("senha_login").value = "";
	document.getElementById("div_principal").style.display = "none";
	document.getElementById("div_inicial").style.display = "";

	document.getElementById("cadastre_se").onclick = function(){
		document.getElementById("div_inicial").style.display = "none";
		document.getElementById("div_principal").style.display = "none";
		document.getElementById("div_cadastro").style.display = "";

		document.getElementById("email_login").value = "";
		document.getElementById("senha_login").value = "";
	}

	document.getElementById("voltar_inicial").onclick = function(){
		document.getElementById("div_inicial").style.display = "";
		document.getElementById("div_cadastro").style.display = "none";
		document.getElementById("div_principal").style.display = "none";
	}

	document.getElementById("login").onclick = function(){
		var data = {
			email: document.getElementById("email_login").value,
			senha: document.getElementById("senha_login").value.hashCode().toString()
		};

		axios
			.post("http://localhost:3000/login/", data)
			.then(res => {
				usuario = res.data;

				document.getElementById("bem_vindo_mensagem").innerHTML = "Olá, " + usuario.nome;
				document.getElementById("div_inicial").style.display = "none";
				document.getElementById("div_cadastro").style.display = "none";
				document.getElementById("div_principal").style.display = "";
			})
			.catch(error => {
				alert(error.response ? error.response.data : error);
			});
	}

	document.getElementById("cadastrar").onclick = function(){
		var data = {
			nome: document.getElementById("nome").value,
			sobrenome: document.getElementById("sobrenome").value,
			email: document.getElementById("email_cadastro").value,
			senha: document.getElementById("senha_cadastro").value.hashCode().toString()
		};

		axios
			.post("http://localhost:3000/cadastro/", data)
	    	.then(response => {
	    		console.log(response);

	    		document.getElementById("div_inicial").style.display = "none";
				document.getElementById("div_cadastro").style.display = "none";
				document.getElementById("div_principal").style.display = "";

				document.getElementById("nome").value = "";
				document.getElementById("sobrenome").value = "";
				document.getElementById("email_cadastro").value = "";
				document.getElementById("senha_cadastro").value = ";"
	    	})
	    	.catch(err => {
	    		alert(err.response.data);
	    	});
	}

	document.getElementById("botao_categorias").onclick = function(){
		let modal = document.getElementById("categorias_modal");
		modal.style.display = "block";

		axios
			.get("http://localhost:3000/buscar_categorias/")
			.then(res => {
				let cats = res.data;
				let lista_categorias = document.getElementById("lista_categorias");

				for(let i = 0; i < cats.length; i++){
					let cat = cats[i];
					let item = document.createElement("li");
					item.innerHTML = cat.nome;
					item.id = "categoria_" + cat.nome;
					item.classList.add("categoria_item");
					lista_categorias.appendChild(item);
				}
			})
			.catch(err => {
				modal.style.display = "none";
				alert(err);
			})
	}

	document.getElementById("close_categorias_modal").onclick = function(){
		document.getElementById("categorias_modal").style.display = "none";
	}

	document.getElementById("imagem_perfil").onclick = function(){
		document.getElementById("titulo_pagina").innerHTML = "Editar Perfil";
		document.getElementById("opcoes_div").style.display = "none";
		document.getElementById("editar_perfil_div").style.display = ""
		document.getElementById("div_cursos").style.display = "none";

		document.getElementById("editar_perfil_nome").value = usuario.nome;
		document.getElementById("editar_perfil_sobrenome").value = usuario.sobrenome;
		document.getElementById("editar_perfil_email").value = usuario.email;
		document.getElementById("editar_perfil_senha").value = "";

		document.getElementById("editar_perfil_status").innerHTML = "";
	}

	document.getElementById("salvar_perfil_botao").onclick = function(){
		let dados = {
			email: usuario.email,
			nome: document.getElementById("editar_perfil_nome").value,
			sobrenome: document.getElementById("editar_perfil_sobrenome").value,
			mudou_senha: document.getElementById("editar_perfil_senha").value != "",
			senha: document.getElementById("editar_perfil_senha").value.hashCode().toString()
		};

		axios
			.post("http://localhost:3000/editar_perfil/", dados)
			.then(res => {
				usuario.nome = dados.nome;
				usuario.sobrenome = dados.sobrenome;

				document.getElementById("editar_perfil_nome").value = usuario.nome;
				document.getElementById("editar_perfil_sobrenome").value = usuario.sobrenome;
				document.getElementById("editar_perfil_senha").value = "";

				document.getElementById("editar_perfil_status").innerHTML = "Sucesso!";
				document.getElementById("editar_perfil_status").style.color = "green";
			})
			.catch(error => {
				document.getElementById("editar_perfil_status").innerHTML = "Erro!";
				document.getElementById("editar_perfil_status").style.color = "red";
			});
	}

	document.getElementById("salvar_perfil_voltar").onclick = function(){
		document.getElementById("opcoes_div").style.display = "";
		document.getElementById("editar_perfil_div").style.display = "none"
		document.getElementById("titulo_pagina").innerHTML = "";	
	}
</script>